<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="VisioAnalytica.App.Risk.Pages.HistoryPage"
             Title="Historial">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            
            <Label 
                Text="Historial de Inspecciones"
                FontSize="20"
                FontAttributes="Bold"
                Margin="0,0,0,10" />

            <CollectionView 
                x:Name="HistoryCollection"
                ItemsSource="{Binding InspectionGroups}"
                IsGrouped="True"
                SelectionMode="Single"
                SelectionChanged="OnSelectionChanged">
                
                <CollectionView.GroupHeaderTemplate>
                    <DataTemplate>
                        <Label Text="{Binding Name}"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"
                               Padding="0,10,0,10" />
                    </DataTemplate>
                </CollectionView.GroupHeaderTemplate>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border 
                            Stroke="Transparent"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 10"
                            Padding="15"
                            Margin="0,0,0,10"
                            BackgroundColor="White">
                            <Border.Shadow>
                                <Shadow Brush="Black" Offset="2,2" Radius="5" Opacity="0.1"/>
                            </Border.Shadow>
                            
                            <Grid ColumnDefinitions="*, Auto" RowDefinitions="Auto, Auto, Auto">
                                <!-- Company Name -->
                                <Label Grid.Row="0" Grid.Column="0"
                                    Text="{Binding CompanyName}"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    TextColor="{StaticResource Gray900}" />
                                
                                <!-- Status Badge -->
                                <Border Grid.Row="0" Grid.Column="1"
                                        StrokeShape="RoundRectangle 4"
                                        BackgroundColor="{Binding StatusColor}"
                                        Padding="8,2"
                                        HorizontalOptions="End">
                                    <Label Text="{Binding Status}"
                                           FontSize="10"
                                           TextColor="White"
                                           FontAttributes="Bold"/>
                                </Border>

                                <!-- Date -->
                                <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                    Text="{Binding Date}"
                                    FontSize="12"
                                    TextColor="{StaticResource Gray600}"
                                    Margin="0,4,0,0" />

                                <!-- Findings Count -->
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" 
                                                     Spacing="5" Margin="0,8,0,0">
                                    <Label Text="⚠️" FontSize="14" VerticalOptions="Center"/>
                                    <Label Text="{Binding FindingsCount, StringFormat='{0} Hallazgos'}"
                                           FontSize="14"
                                           TextColor="{StaticResource Gray900}"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Label 
                x:Name="EmptyLabel"
                Text="No hay inspecciones registradas."
                FontSize="16"
                TextColor="Gray"
                HorizontalOptions="Center"
                Margin="0,20,0,0"
                IsVisible="False" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

